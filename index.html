<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ctrl Alt Tec Bits</title>
    <style>
        body{
            background: #f9f9fa;
            font-family: ui-rounded, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Fira Sans", Oxygen, Ubuntu, "Helvetica Neue", sans-serif
        }
    </style>
</head>
<body>
    <header>
        <h1>Bits</h1>
    </header>
    <section>

    </section>


    <script>
        fetch('http://ctrl-api.hackclub.com/api/participation?org=ctrl-alt-tec').then(d=>d.json()).then(data=>{
            Object.values(data.members)
                .sort((a, b) => b._participations?.total - a._participations?.total)
                .forEach(member=>{
                    let element = document.createElement('p');
                    element.innerHTML = `${member['Nombre(s)']} ${member['Apellido Paterno']} ${member['Apellido Materno']}`;

                    element.addEventListener('click', e=>{
                        let modal = document.createElement('alt-ui-modal');
                        let memberDetails = document.createElement('alt-member-detail');
                        memberDetails.setAttribute('img-src', `http://ctrl-api.hackclub.com/utils/identicon/${member['Matrícula']}`);
                        memberDetails.setAttribute('member-name', `${member['Nombre(s)']} ${member['Apellido Paterno']} ${member['Apellido Materno']}`)
                        memberDetails.setAttribute('member-id', member['Matrícula'])
                        memberDetails.setAttribute('member-total', member._participations.total)
                        memberDetails.setAttribute('member-academic-program', member['Programa/Carrera (Siglas)']);
                        memberDetails.setAttribute('member-academic-semester', member['Semestre']);
                        member._participations.participations.forEach(memberDetails.addParticipation.bind(memberDetails));
                        modal.append(memberDetails);
                        document.body.append(modal)
                    })


                    document.querySelector('section').append(element);

                })
        })




        /* fetch('http://ctrl-api.hackclub.com/api/participation?org=ctrl-alt-tec').then(d=>d.json()).then(data=>{
            Object.values(data.members).sort((a, b) => b?._participations?.total - a?._participations?.total).forEach(member => {
                let div = document.createElement('div');
                div.style.padding = '16px';
                div.innerHTML = JSON.stringify(member);
                document.querySelector('section').append(div)

                div.addEventListener('click', e=>{
                    let modal = document.createElement('alt-ui-modal');
                    let details = document.createElement('alt-member-detail');
                    details.setAttribute('img-src', `http://ctrl-api.hackclub.com/utils/identicon/${member['Matrícula']}`);
                    details.setAttribute('member-name', `${member['Nombre(s)']} ${member['Apellido Paterno']} ${member['Apellido Materno']}`)
                    details.setAttribute('member-id', member['Matrícula'])
                    details.setAttribute('member-total', member._participations.total)
                    details.setAttribute('member-academic-program', member['Programa/Carrera (Siglas)']);
                    details.setAttribute('member-academic-semester', member['Semestre'])

                    member._participations.participations.forEach(participation=>{
                        details.addParticipation(participation);
                    })


                    modal.append(details);
                    document.body.append(modal)
                })

            })
        }) */
    </script>
    <script src="./index.js" type="module"></script>
</body>
</html>